<style>
.toggle-password {
    color: #555;
    user-select: none;
}
.toggle-password:hover {
    opacity: 0.8;
}
</style>
<div class="container-fluid page-body-wrapper full-page-wrapper">
    <div class="content-wrapper d-flex align-items-center auth px-0">
      <div class="row w-100 mx-0">
        <div class="col-lg-4 mx-auto">
          <!-- <div class="auth-form-light text-left py-5 px-4 px-sm-5"> -->
          <div class="auth-form-light text-left loginWrapper">
            <!-- <div class="brand-logo brand_logo_cus">
              <img src="/images/logo.png" alt="logo" style="width: 75px !important;height: auto; ">
            </div> -->
           
            <h4>Welcome to West Bengal Co-operative Officers' Association. </h4>
            <h6 class="font-weight-light">Sign in to continue.</h6>
            <form id="loginForm" autocomplete="off" class="pt-3">
  <div class="form-group">
    <input type="text" class="form-control form-control-lg" placeholder="Username" name="user_id" required>
  </div>

  <div class="form-group position-relative">
    <input type="password" 
           class="form-control form-control-lg" 
           placeholder="Password" 
           name="password" 
           id="passwordField" 
           required>

    <i class="fa-solid fa-eye" id="togglePassword"
       style="position:absolute; top:50%; right:15px; transform:translateY(-50%); cursor:pointer; color:#555;"></i>
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-4">
        <label>Captcha: <strong><%= captcha %></strong></label>
      </div>
      <div class="col-md-4">
        <input type="text" id="captchaInput" name="captchaInput" class="form-control" required>
      </div>
    </div>
  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn">
      SIGN IN
    </button>
  </div>

  <div id="errorMsg" style="color:red;margin-top:10px;font-weight:bold;"></div>
</form>
          </div>
        </div>
      </div>
    </div>
    <!-- content-wrapper ends -->
  </div>
  <!-- page-body-wrapper ends -->

  <script>
   const urlParams = new URLSearchParams(window.location.search);
const errorMsg = urlParams.get('msg');
if (errorMsg) {
    alert(errorMsg);
  //console.log(errorMsg);
}
    </script>

    <script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // STOP normal form submit

      const formData = {
        user_id: document.querySelector('[name=user_id]').value,
        password: document.querySelector('[name=password]').value,
        captchaInput: document.querySelector('[name=captchaInput]').value
        };

      let res = await fetch("/login/logincheck", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(formData)
      });

     const data = await res.json();

    if (data.suc === 1) {
        window.location.href = "/dashn/dash"; // redirect manually
    } else {
        document.getElementById("errorMsg").innerHTML = data.msg;
    }
});

    document.getElementById("togglePassword").addEventListener("click", function () {
    const passwordInput = document.getElementById("passwordField");

          if (passwordInput.type === "password") {
              passwordInput.type = "text";
              this.classList.remove("fa-eye");
              this.classList.add("fa-eye-slash");
          } else {
              passwordInput.type = "password";
              this.classList.remove("fa-eye-slash");
              this.classList.add("fa-eye");
          }
     });
</script>